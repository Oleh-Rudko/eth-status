<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ethereum –¢—Ä–µ–∫–µ—Ä</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 600px;
            width: 100%;
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
            font-size: 28px;
        }

        .logo {
            text-align: center;
            font-size: 50px;
            margin-bottom: 20px;
        }

        h2 {
            color: #555;
            font-size: 18px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .purchases-list {
            margin-bottom: 20px;
        }

        .purchase-item {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .purchase-item input {
            flex: 1;
            padding: 10px 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s;
        }

        .purchase-item input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .purchase-item .input-wrapper {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .purchase-item .input-label {
            font-size: 11px;
            color: #888;
            font-weight: 500;
        }

        .btn-remove {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border: none;
            background: #fee2e2;
            color: #991b1b;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.2s;
            flex-shrink: 0;
        }

        .btn-remove:hover {
            background: #fecaca;
            transform: scale(1.1);
        }

        .btn-add {
            width: 100%;
            padding: 12px;
            background: #f0f9ff;
            color: #0369a1;
            border: 2px dashed #0369a1;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            margin-bottom: 20px;
        }

        .btn-add:hover {
            background: #e0f2fe;
        }

        .btn-refresh {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .btn-refresh:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .btn-refresh:active {
            transform: translateY(0);
        }

        .results {
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            display: none;
        }

        .results.show {
            display: block;
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            padding-bottom: 12px;
            border-bottom: 1px solid #e0e0e0;
        }

        .result-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .result-label {
            color: #666;
            font-weight: 500;
        }

        .result-value {
            font-weight: 600;
            color: #333;
        }

        .profit {
            color: #10b981;
        }

        .loss {
            color: #ef4444;
        }

        .profit-box {
            margin-top: 15px;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            font-size: 20px;
            font-weight: 700;
        }

        .profit-box.profit {
            background: #d1fae5;
            color: #065f46;
        }

        .profit-box.loss {
            background: #fee2e2;
            color: #991b1b;
        }

        .purchases-breakdown {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 2px solid #e0e0e0;
        }

        .purchases-breakdown h3 {
            font-size: 14px;
            color: #666;
            margin-bottom: 10px;
        }

        .breakdown-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            font-size: 13px;
            border-bottom: 1px solid #eee;
        }

        .breakdown-item:last-child {
            border-bottom: none;
        }

        .breakdown-details {
            color: #666;
        }

        .breakdown-profit {
            font-weight: 600;
        }

        .loading {
            text-align: center;
            color: #667eea;
            margin-top: 10px;
            font-weight: 500;
            display: none;
        }

        .loading.show {
            display: block;
        }

        .error {
            background: #fee2e2;
            color: #991b1b;
            padding: 12px;
            border-radius: 10px;
            margin-top: 15px;
            display: none;
        }

        .error.show {
            display: block;
        }

        @media (max-width: 500px) {
            .purchase-item {
                flex-wrap: wrap;
            }

            .purchase-item .input-wrapper {
                min-width: calc(50% - 25px);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="logo">üíé</div>
        <h1>Ethereum –¢—Ä–µ–∫–µ—Ä</h1>

        <h2>
            –ú–æ—ó –ø–æ–∫—É–ø–∫–∏
        </h2>

        <div class="purchases-list" id="purchasesList">
        </div>

        <button class="btn-add" onclick="addPurchase()">+ –î–æ–¥–∞—Ç–∏ –ø–æ–∫—É–ø–∫—É</button>

        <button class="btn-refresh" onclick="refreshData()">–û–Ω–æ–≤–∏—Ç–∏</button>

        <div class="loading" id="loading">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</div>
        <div class="error" id="error"></div>

        <div class="results" id="results">
            <div class="result-item">
                <span class="result-label">–ü–æ—Ç–æ—á–Ω–∞ —Ü—ñ–Ω–∞ ETH:</span>
                <span class="result-value" id="currentPrice">-</span>
            </div>
            <div class="result-item">
                <span class="result-label">–ó–∞–≥–∞–ª—å–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å ETH:</span>
                <span class="result-value" id="totalEth">-</span>
            </div>
            <div class="result-item">
                <span class="result-label">–ó–∞–≥–∞–ª—å–Ω–∞ —ñ–Ω–≤–µ—Å—Ç–∏—Ü—ñ—è:</span>
                <span class="result-value" id="investment">-</span>
            </div>
            <div class="result-item">
                <span class="result-label">–ü–æ—Ç–æ—á–Ω–∞ –≤–∞—Ä—Ç—ñ—Å—Ç—å:</span>
                <span class="result-value" id="currentValue">-</span>
            </div>
            <div class="result-item">
                <span class="result-label">–°–µ—Ä–µ–¥–Ω—è —Ü—ñ–Ω–∞ –ø–æ–∫—É–ø–∫–∏:</span>
                <span class="result-value" id="avgPrice">-</span>
            </div>
            <div class="profit-box" id="profitBox">
                <div id="profitLabel">–ó–∞–≥–∞–ª—å–Ω–∏–π –ø—Ä–∏–±—É—Ç–æ–∫ / –∑–±–∏—Ç–æ–∫</div>
                <div id="profitValue">-</div>
            </div>

            <div class="purchases-breakdown" id="purchasesBreakdown">
                <h3>–î–µ—Ç–∞–ª—ñ –ø–æ –ø–æ–∫—É–ø–∫–∞—Ö:</h3>
                <div id="breakdownList"></div>
            </div>
        </div>
    </div>

    <script>
        let purchases = [];

        window.addEventListener('load', function() {
            const savedPurchases = localStorage.getItem('ethPurchases');

            if (savedPurchases) {
                purchases = JSON.parse(savedPurchases);
                renderPurchases();
                if (purchases.length > 0) {
                    refreshData();
                }
            } else {
                addPurchase();
            }
        });

        function addPurchase(ethAmount = '', buyPrice = '') {
            purchases.push({ ethAmount, buyPrice });
            renderPurchases();
        }

        function removePurchase(index) {
            if (purchases.length > 1) {
                purchases.splice(index, 1);
                renderPurchases();
                savePurchases();
            }
        }

        function createPurchaseElement(purchase, index) {
            const item = document.createElement('div');
            item.className = 'purchase-item';

            const ethWrapper = document.createElement('div');
            ethWrapper.className = 'input-wrapper';

            const ethLabel = document.createElement('span');
            ethLabel.className = 'input-label';
            ethLabel.textContent = '–ö—ñ–ª—å–∫—ñ—Å—Ç—å ETH';

            const ethInput = document.createElement('input');
            ethInput.type = 'number';
            ethInput.step = '0.000001';
            ethInput.placeholder = '0.5';
            ethInput.value = purchase.ethAmount;
            ethInput.addEventListener('change', function() {
                updatePurchase(index, 'ethAmount', this.value);
            });
            ethInput.addEventListener('keypress', handleKeyPress);

            ethWrapper.appendChild(ethLabel);
            ethWrapper.appendChild(ethInput);

            const priceWrapper = document.createElement('div');
            priceWrapper.className = 'input-wrapper';

            const priceLabel = document.createElement('span');
            priceLabel.className = 'input-label';
            priceLabel.textContent = '–¶—ñ–Ω–∞ –ø–æ–∫—É–ø–∫–∏ (USD)';

            const priceInput = document.createElement('input');
            priceInput.type = 'number';
            priceInput.step = '0.01';
            priceInput.placeholder = '2500';
            priceInput.value = purchase.buyPrice;
            priceInput.addEventListener('change', function() {
                updatePurchase(index, 'buyPrice', this.value);
            });
            priceInput.addEventListener('keypress', handleKeyPress);

            priceWrapper.appendChild(priceLabel);
            priceWrapper.appendChild(priceInput);

            const removeBtn = document.createElement('button');
            removeBtn.className = 'btn-remove';
            removeBtn.textContent = '√ó';
            removeBtn.addEventListener('click', function() {
                removePurchase(index);
            });

            if (purchases.length === 1) {
                removeBtn.disabled = true;
                removeBtn.style.opacity = '0.3';
                removeBtn.style.cursor = 'not-allowed';
            }

            item.appendChild(ethWrapper);
            item.appendChild(priceWrapper);
            item.appendChild(removeBtn);

            return item;
        }

        function renderPurchases() {
            const container = document.getElementById('purchasesList');
            container.replaceChildren();

            purchases.forEach((purchase, index) => {
                container.appendChild(createPurchaseElement(purchase, index));
            });
        }

        function updatePurchase(index, field, value) {
            purchases[index][field] = value;
            savePurchases();
        }

        function savePurchases() {
            localStorage.setItem('ethPurchases', JSON.stringify(purchases));
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                refreshData();
            }
        }

        async function refreshData() {
            const inputs = document.querySelectorAll('.purchase-item');
            inputs.forEach((item, index) => {
                const ethInput = item.querySelectorAll('input')[0];
                const priceInput = item.querySelectorAll('input')[1];
                purchases[index] = {
                    ethAmount: ethInput.value,
                    buyPrice: priceInput.value
                };
            });

            const validPurchases = purchases.filter(p => {
                const eth = parseFloat(p.ethAmount);
                const price = parseFloat(p.buyPrice);
                return eth > 0 && price > 0;
            });

            if (validPurchases.length === 0) {
                showError('–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å —Ö–æ—á–∞ –± –æ–¥–Ω—É –ø–æ–∫—É–ø–∫—É –∑ –∫–æ—Ä–µ–∫—Ç–Ω–∏–º–∏ –¥–∞–Ω–∏–º–∏');
                return;
            }

            savePurchases();

            showLoading();
            hideError();
            hideResults();

            try {
                if (!navigator.onLine) {
                    throw new Error('–ù–µ–º–∞—î –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç—É');
                }

                const response = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=ethereum&vs_currencies=usd', {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json',
                    }
                });

                if (!response.ok) {
                    if (response.status === 429) {
                        throw new Error('–ó–∞–±–∞–≥–∞—Ç–æ –∑–∞–ø–∏—Ç—ñ–≤. –°–ø—Ä–æ–±—É–π—Ç–µ —á–µ—Ä–µ–∑ —Ö–≤–∏–ª–∏–Ω—É.');
                    }
                    throw new Error('–ü–æ–º–∏–ª–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞: ' + response.status);
                }

                const data = await response.json();

                if (!data.ethereum || !data.ethereum.usd) {
                    throw new Error('–ù–µ–≤—ñ—Ä–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –≤—ñ–¥ API');
                }

                const currentPrice = parseFloat(data.ethereum.usd);

                let totalEth = 0;
                let totalInvestment = 0;
                const breakdownData = [];

                validPurchases.forEach(function(purchase) {
                    const eth = parseFloat(purchase.ethAmount);
                    const buyPrice = parseFloat(purchase.buyPrice);
                    const invested = eth * buyPrice;
                    const currentVal = eth * currentPrice;
                    const profit = currentVal - invested;
                    const profitPercent = ((profit / invested) * 100).toFixed(2);

                    totalEth += eth;
                    totalInvestment += invested;

                    breakdownData.push({
                        eth: eth,
                        buyPrice: buyPrice,
                        invested: invested,
                        currentVal: currentVal,
                        profit: profit,
                        profitPercent: profitPercent
                    });
                });

                const totalCurrentValue = totalEth * currentPrice;
                const totalProfitLoss = totalCurrentValue - totalInvestment;
                const totalProfitLossPercent = ((totalProfitLoss / totalInvestment) * 100).toFixed(2);
                const avgBuyPrice = totalInvestment / totalEth;

                document.getElementById('currentPrice').textContent = '$' + currentPrice.toFixed(2);
                document.getElementById('totalEth').textContent = totalEth.toFixed(6) + ' ETH';
                document.getElementById('investment').textContent = '$' + totalInvestment.toFixed(2);
                document.getElementById('currentValue').textContent = '$' + totalCurrentValue.toFixed(2);
                document.getElementById('avgPrice').textContent = '$' + avgBuyPrice.toFixed(2);

                const profitBox = document.getElementById('profitBox');
                const profitValue = document.getElementById('profitValue');

                if (totalProfitLoss >= 0) {
                    profitBox.className = 'profit-box profit';
                    profitValue.textContent = '+$' + totalProfitLoss.toFixed(2) + ' (+' + totalProfitLossPercent + '%)';
                } else {
                    profitBox.className = 'profit-box loss';
                    profitValue.textContent = '$' + totalProfitLoss.toFixed(2) + ' (' + totalProfitLossPercent + '%)';
                }

                renderBreakdown(breakdownData);

                hideLoading();
                showResults();

            } catch (error) {
                console.error('–ü–æ–º–∏–ª–∫–∞:', error);
                let errorMessage = '–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –æ—Ç—Ä–∏–º–∞–Ω–Ω—ñ –¥–∞–Ω–∏—Ö: ';

                if (error.name === 'TypeError' && error.message === 'Failed to fetch') {
                    errorMessage += '–ù–µ –≤–¥–∞–ª–æ—Å—è –ø—ñ–¥–∫–ª—é—á–∏—Ç–∏—Å—è –¥–æ —Å–µ—Ä–≤–µ—Ä–∞. –ú–æ–∂–ª–∏–≤–æ CORS –±–ª–æ–∫—É–≤–∞–Ω–Ω—è –∞–±–æ –ø—Ä–æ–±–ª–µ–º–∞ –∑ –º–µ—Ä–µ–∂–µ—é.';
                } else {
                    errorMessage += error.message;
                }

                showError(errorMessage);
                hideLoading();
            }
        }

        function renderBreakdown(breakdownData) {
            const breakdownList = document.getElementById('breakdownList');
            breakdownList.replaceChildren();

            breakdownData.forEach(function(item) {
                const div = document.createElement('div');
                div.className = 'breakdown-item';

                const details = document.createElement('span');
                details.className = 'breakdown-details';
                details.textContent = item.eth.toFixed(4) + ' ETH @ $' + item.buyPrice.toFixed(2);

                const profitSpan = document.createElement('span');
                profitSpan.className = 'breakdown-profit ' + (item.profit >= 0 ? 'profit' : 'loss');

                const sign = item.profit >= 0 ? '+' : '';
                profitSpan.textContent = sign + '$' + item.profit.toFixed(2) + ' (' + sign + item.profitPercent + '%)';

                div.appendChild(details);
                div.appendChild(profitSpan);
                breakdownList.appendChild(div);
            });
        }

        function showLoading() {
            document.getElementById('loading').classList.add('show');
        }

        function hideLoading() {
            document.getElementById('loading').classList.remove('show');
        }

        function showResults() {
            document.getElementById('results').classList.add('show');
        }

        function hideResults() {
            document.getElementById('results').classList.remove('show');
        }

        function showError(message) {
            const errorDiv = document.getElementById('error');
            errorDiv.textContent = message;
            errorDiv.classList.add('show');
        }

        function hideError() {
            document.getElementById('error').classList.remove('show');
        }
    </script>
</body>
</html>
